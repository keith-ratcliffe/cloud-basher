---
title: "DataWave Data Model"
tags: [getting_started, data_model, ingest, query]
summary: DataWave utilizes the Accumulo tables schemas described below to implement its
---

## Primary Data Table

The primary data table uses a sharded approach and can be described as an intra-day hash partitioned table
where fields in a data object are stored collocated in a single partition. The *Shard ID* is a function of
the *UID* and therefore should be reproducible given the same object ingested at different points in time. This enables
de-duplication of objects when they are re-ingested. The *Data Type* is a user defined category of the data that will
typically be used at query time. The *Data Type* allows for further reduction in the amount of data to be searched.

The primary data table also contains an in-partition index, which we call the *Field Index*, and we denote the K,V
pairs that are in the field index with a leading 'fi' in the column family. The field index is used by
custom Accumulo iterators at query time to find data objects in the partition.

Optionally, if the table is used to store documents, then the original document or different views of the
document can be stored in the 'd' column family. Typically this column family would be set up as its own
locality group. An example of different views of a document could be .txt and .html versions of the original
document.

To enable phrase queries on documents, the 'tf' column family contains a protocol buffer (PB) in the value
that is a list of word offsets for the term in the document. This too could also be stored in a separate
locality group.

{% include table_primary.html %}

## Global Index Tables

The *forward* and *reverse* index tables serve as global indexes mapping terms to partitions. The index maps a
*NFN:NFV* pair to a category of data within the partitions of the primary data table. The *Uid.List Protocol Buffer (ULPB)* object contains
the number of occurrences of the *NFN:NFV* pair in a category of data in the partition. Additionally, the *ULPB* may contain
the UIDs of the objects that contain the *NFN:NFV*. We say “may contain” because there is an upper limit on the number of
UIDs in the *ULPB*.

{% include table_index_fwd.html %}

*NFV*'s that are indexed within the global reverse index table can be searched using leading wildcards. Thus, the index
is created by simply reversing the characters in the *NFV*...

{% include table_index_rev.html %}

## Data Dictionary Table

The data dictionary table contains information about the data stored in the other tables, to include
whether or not a field is indexed, the normalizer that is used for the field, etc. The structure of the table
is as follows.

{% include table_metadata.html %}

## Edge Table

The edge table may represent one or more graphs, any of which can be unidirectional or bidirectional depending on the user's
needs. A single edge key represents a unidirectional pair of *Normalized Field Value* vertices, which may be thought of
as the *source* vertex and the *sink* vertex respectively. Thus, bidirectional edges are generated by simply creating a
second edge key having the original *source*, *sink*, and other attributes reversed. Additional information may be encoded
into an edge key as well, such as the *relationship* between the two vertices, the *type* of the edge, and others.

{% include table_edge.html %}

## Date Index Table

The date index table maps known date fields and their values (categorized by *Date Type Name*) to the
shards in the Data Table in which they are found. This facilitates user queries that utilize these Date
Types as the basis for date range filtering, rather than the date range default, which is based on the date
value encoded into the Data Table's *Shard ID*

{% include table_index_date.html %}

## Load Dates Table

The load dates table tracks the dates on which specific field names were loaded into specific tables via DataWave Ingest.
This information may be leveraged internally for the purposes of query optimization, load date-based filtering for queries,
etc.

{% include table_load_dates.html %}

## Other Tables

### Ingest Error Tables

The layouts associated with the four ingest error tables are identical to those listed above for the *Primary Data Table*,
*Global Index Tables*, and *Data Dictionary Table*. The only difference is that the respective error tables here are meant
to capture *Data Objects* that failed to be fully loaded during ingest due to one or more processing errors.

Thus, these tables are intended to capture any successfully-processed NFN:FV pairs, just as they would have appeared in
the normal schema, along with additional NFN keys related to the errors themselves, so that error discovery and
troubleshooting can proceed as efficiently as possible. Since schema descriptions for the primary data tables apply here
as well, we describe below only the specific *Data Object* entries that are used to convey information about the error(s)

{% include table_ingest_errors.html %}

### Query Metrics Tables

The layouts associated with the four query metrics tables are identical to those listed above for the *Primary Data Table*,
*Global Index Tables*, and *Data Dictionary Table*. The only difference here is that the respective query metrics tables
are intended to persist information associated with user queries exclusively. They can be leveraged by users to gain insight
into their own queries, and by administrators to gain insight into active and historical queries. Since schema descriptions
for the primary data tables apply here as well, we describe below only the specific NFN and FV components that are used to
represent a query *Data Object*.

**Note**: The *Data Type (DT)* portion of all respective keys is denoted by the literal **querymetrics**

**Note**: The *YYYYMMDD* value that is created for the *Shard ID* partition identifies the creation date of the query

{% include table_query_metrics.html %}

## Terms and Definitions

{% include data_model_terms.html %}

[apache_accumulo]: http://accumulo.apache.org/
[apache_hadoop]: http://hadoop.apache.org/
[data_fusion]: https://en.wikipedia.org/wiki/Data_fusion
[graph_theory]: https://en.wikipedia.org/wiki/Graph_theory
[cell_level_sec]: https://accumulo.apache.org/1.8/accumulo_user_manual.html#_security
[acc_data_model]: https://accumulo.apache.org/1.8/accumulo_user_manual.html#_data_model
